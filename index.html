<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>An Toàn Bếp (Fixed UI)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @keyframes float { 0% { transform: translateY(0) scale(1); opacity: 0; } 20% { opacity: 0.6; } 100% { transform: translateY(-80px) scale(2); opacity: 0; } }
        @keyframes flash { 0%, 100% { opacity: 1; } 50% { opacity: 0.8; } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-2px) rotate(-1deg); } 75% { transform: translateX(2px) rotate(1deg); } }
        body { touch-action: manipulation; -webkit-tap-highlight-color: transparent; }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 h-screen overflow-hidden flex flex-col">

    <div id="root" class="w-full h-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { createRoot } = ReactDOM;

        // --- 1. AUDIO ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const playSound = (type) => {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const now = audioCtx.currentTime;
            
            if (type === 'click') {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain); gain.connect(audioCtx.destination);
                osc.frequency.setValueAtTime(600, now);
                osc.frequency.exponentialRampToValueAtTime(300, now + 0.1);
                gain.gain.setValueAtTime(0.3, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                osc.start(now); osc.stop(now + 0.1);
            } 
            else if (type === 'correct') {
                [523.25, 659.25, 783.99].forEach((freq, i) => {
                    const o = audioCtx.createOscillator();
                    const g = audioCtx.createGain();
                    o.connect(g); g.connect(audioCtx.destination);
                    o.frequency.value = freq;
                    g.gain.setValueAtTime(0.1, now + i*0.05);
                    g.gain.exponentialRampToValueAtTime(0.001, now + 0.5 + i*0.05);
                    o.start(now + i*0.05); o.stop(now + 0.6 + i*0.05);
                });
            } 
            else if (type === 'wrong') {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain); gain.connect(audioCtx.destination);
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, now);
                osc.frequency.linearRampToValueAtTime(100, now + 0.3);
                gain.gain.setValueAtTime(0.3, now);
                gain.gain.linearRampToValueAtTime(0.01, now + 0.3);
                osc.start(now); osc.stop(now + 0.3);
            }
            else if (type === 'explosion') {
                const bufferSize = audioCtx.sampleRate * 1.5;
                const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
                const data = buffer.getChannelData(0);
                for (let i = 0; i < bufferSize; i++) data[i] = Math.random() * 2 - 1;
                const noise = audioCtx.createBufferSource();
                noise.buffer = buffer;
                const filter = audioCtx.createBiquadFilter();
                filter.type = 'lowpass'; filter.frequency.value = 1000;
                const gain = audioCtx.createGain();
                gain.gain.setValueAtTime(1, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 1.5);
                noise.connect(filter); filter.connect(gain); gain.connect(audioCtx.destination);
                noise.start(now);
            }
        };

        // --- 2. ICONS ---
        const Icon = ({ path, color="currentColor", size=24, className="" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} dangerouslySetInnerHTML={{ __html: path }} />
        );
        const Icons = {
            Play: (p) => <Icon {...p} path='<polygon points="5 3 19 12 5 21 5 3"></polygon>' />,
            Pause: (p) => <Icon {...p} path='<rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect>' />,
            Flame: (p) => <Icon {...p} path='<path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.1.2-2.2.5-3.3.3-1.1 1-2.2 2-3.3.5 1.1 1 2.2 1 3.3z"></path>' />,
            Check: (p) => <Icon {...p} path='<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline>' />,
            X: (p) => <Icon {...p} path='<circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line>' />,
            Alert: (p) => <Icon {...p} path='<path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line>' />,
            Zap: (p) => <Icon {...p} path='<polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>' />,
            Thermo: (p) => <Icon {...p} path='<path d="M14 14.76V3.5a2.5 2.5 0 0 0-5 0v11.26a4.5 4.5 0 1 0 5 0z"></path>' />,
            Hat: (p) => <Icon {...p} path='<path d="M6 13.87A4 4 0 0 1 7.41 6a5.11 5.11 0 0 1 1.05-1.54 5 5 0 0 1 7.08 0A5.11 5.11 0 0 1 16.59 6 4 4 0 0 1 18 13.87V21H6Z"></path><line x1="6" y1="17" x2="18" y2="17"></line>' />,
            Drop: (p) => <Icon {...p} path='<path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.8-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z"></path><path d="M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97"></path>' />,
            Ext: (p) => <Icon {...p} path='<path d="M15 6.5V3a1 1 0 0 0-1-1h-2a1 1 0 0 0-1 1v3.5"></path><path d="M9 18h8"></path><path d="M18 6h-4a3 3 0 0 0-3 3v13h10V9a3 3 0 0 0-3-3z"></path>' />,
            Max: (p) => <Icon {...p} path='<path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>' />
        };

        // --- 3. DATA ---
        const SCENARIOS = [
            { id: 1, duration: 4000, text: "Giai đoạn 1", subtext: "Dầu đang nóng lên...", visual: "boiling", intensity: 1, quiz: null },
            { id: 2, duration: 0, text: "CÂU HỎI 1", visual: "boiling", subtext: "Bạn thấy dấu hiệu gì?", intensity: 1, quiz: { question: "Dấu hiệu nào cho thấy dầu sắp bốc cháy?", options: [ { id: 'A', text: "Dầu sôi nhẹ.", correct: false, feedback: "Sai. Đây là bình thường." }, { id: 'B', text: "Khói trắng.", correct: false, feedback: "Sai. Đó là hơi nước." }, { id: 'C', text: "Khói đen dày đặc.", correct: true, feedback: "Chính xác! Dầu đã quá nhiệt." } ] } },
            { id: 3, duration: 3000, text: "Giai đoạn 2", subtext: "Bạn bị xao nhãng!", visual: "distracted", intensity: 2, quiz: null },
            { id: 4, duration: 0, text: "CÂU HỎI 2", visual: "smoke", subtext: "Khói đen bốc lên!", intensity: 3, quiz: { question: "Hành động ĐÚNG NHẤT lúc này?", options: [ { id: 'A', text: "Tắt bếp ngay.", correct: true, feedback: "Chính xác! Ngắt nguồn nhiệt ngay lập tức." }, { id: 'B', text: "Thổi vào chảo.", correct: false, feedback: "Sai! Thổi cung cấp thêm Oxy." }, { id: 'C', text: "Đổ dầu lạnh vào.", correct: false, feedback: "Nguy hiểm! Gây bắn dầu." } ] } },
            { id: 5, duration: 3000, text: "LỬA BÙNG PHÁT!", visual: "fire_start", subtext: "Chảo đã bắt lửa!", intensity: 4, quiz: null },
            { id: 6, duration: 0, text: "CÂU HỎI 3", visual: "fire_start", subtext: "Dùng gì để dập?", intensity: 4, quiz: { question: "Bình chữa cháy nào phù hợp?", options: [ { id: 'A', text: "Bình bột.", correct: false, feedback: "Không tối ưu cho dầu mỡ." }, { id: 'B', text: "Bình CO2.", correct: false, feedback: "Nguy hiểm, có thể thổi bay dầu." }, { id: 'C', text: "Bình hóa chất ướt (K).", correct: true, feedback: "Tuyệt vời! Tạo lớp màng ngăn oxy." } ] } },
            { id: 7, duration: 3000, text: "NGUY CẤP!", visual: "fire_big", subtext: "Không có bình cứu hỏa...", intensity: 5, quiz: null },
            { id: 8, duration: 0, text: "CÂU HỎI 4", visual: "fire_critical", subtext: "Trên tay có cốc nước...", intensity: 5, quiz: { question: "Có tạt nước vào không?", options: [ { id: 'A', text: "TẠT NGAY!", correct: false, fatal: true, feedback: "THẢM HỌA! Nổ hơi nước (Boilover)." }, { id: 'B', text: "KHÔNG BAO GIỜ!", correct: true, feedback: "Sáng suốt! Nước và dầu kỵ nhau." } ] } },
            { id: 9, duration: 0, text: "CÂU HỎI 5", visual: "fire_big", subtext: "Chọn vật dụng thay thế:", intensity: 5, quiz: { question: "Dụng cụ nào dập lửa an toàn?", options: [ { id: 'A', text: "Nắp vung (kim loại).", correct: true, feedback: "Tuyệt vời! Cắt nguồn Oxy." }, { id: 'B', text: "Khăn khô.", correct: false, feedback: "Sai. Khăn khô dễ cháy." }, { id: 'C', text: "Bê chảo chạy.", correct: false, feedback: "Rủi ro cao." } ] } },
            { id: 10, duration: 0, text: "CÂU HỎI 6", visual: "success", subtext: "Lửa đã tắt.", intensity: 0, quiz: { question: "Khi nào mở nắp kiểm tra?", options: [ { id: 'A', text: "Mở ngay.", correct: false, feedback: "Lửa sẽ bùng lại." }, { id: 'B', text: "Chờ nguội hẳn (15p).", correct: true, feedback: "Chính xác!" }, { id: 'C', text: "Hé nhẹ.", correct: false, feedback: "Vẫn nguy hiểm." } ] } },
            { id: 11, duration: 4000, text: "KẾT THÚC", visual: "success", subtext: "Bạn đã an toàn.", intensity: 0, quiz: null }
        ];

        // --- 4. VISUALS ---
        const Visuals = {
            Boil: () => <div className="absolute inset-0 overflow-hidden rounded-b-3xl">{[...Array(12)].map((_, i) => <div key={i} className="absolute bg-yellow-100 rounded-full opacity-70 animate-[ping_1s_infinite]" style={{ width: Math.random()*15+5+'px', height: Math.random()*15+5+'px', left: Math.random()*80+10+'%', top: Math.random()*60+20+'%', animationDelay: Math.random()+'s', animationDuration: (0.3+Math.random())+'s' }} />)}</div>,
            Smoke: ({d=1}) => <div className="absolute bottom-full left-1/2 -translate-x-1/2 w-60 h-80 pointer-events-none z-0">{[...Array(d*6)].map((_, i) => <div key={i} className="absolute rounded-full blur-2xl animate-[float_3s_linear_infinite]" style={{ width: Math.random()*60+40+'px', height: Math.random()*60+40+'px', background: i%3===0?'#111':'#333', left: (Math.random()*100-50)+'%', bottom: '-40px', opacity: 0, animationDelay: (i*0.3)+'s' }} />)}</div>,
            Fire: ({s=1}) => <div className="absolute bottom-5 left-1/2 -translate-x-1/2 z-10 filter drop-shadow-[0_0_25px_rgba(255,80,0,0.8)]" style={{ transform: `scale(${s*1.5}) translateX(-33%)` }}><div className="relative w-32 h-48"><div className="absolute bottom-0 w-full h-full bg-gradient-to-t from-red-600 via-orange-500 to-yellow-300 rounded-[40%_40%_40%_40%] blur-md animate-[pulse_0.15s_infinite] origin-bottom scale-y-125"></div><div className="absolute bottom-4 left-4 w-[80%] h-[80%] bg-gradient-to-t from-orange-300 to-white rounded-[50%] blur-lg animate-[bounce_0.25s_infinite]"></div></div></div>,
            Stove: ({i}) => <div className="absolute bottom-[-50px] left-1/2 -translate-x-1/2 flex flex-col items-center w-full z-0 scale-75 md:scale-100 origin-bottom"><div className="relative w-48 h-16 -mb-5 z-10 flex justify-center items-end gap-1.5 opacity-90">{[...Array(14)].map((_, idx) => <div key={idx} className={`w-3 rounded-t-full blur-[2px] animate-[pulse_0.1s_infinite] ${i>3?'bg-orange-500 h-10 shadow-[0_0_10px_orange]':'bg-blue-500 h-6 shadow-[0_0_10px_blue]'}`} style={{ animationDelay: (Math.random()*0.5)+'s', height: (i>3?Math.random()*20+30:Math.random()*8+18)+'px' }}></div>)}</div><div className="w-56 h-4 bg-gray-800 rounded-full border-2 border-gray-600 z-10 relative shadow-lg"></div><div className="w-96 h-14 bg-gray-900 rounded-lg border-t-4 border-gray-700 mt-[-2px] shadow-2xl relative z-0 flex justify-center items-center"><span className="text-gray-600 font-bold text-[10px] tracking-widest uppercase mt-4">SafeStove Pro</span></div></div>
        };

        function App() {
            const [play, setPlay] = useState(false);
            const [idx, setIdx] = useState(0);
            const [quiz, setQuiz] = useState(false);
            const [fb, setFb] = useState(null);
            const [state, setState] = useState('intro');
            const timer = useRef(null);
            const scene = SCENARIOS[idx];

            useEffect(() => {
                if (play && state === 'play' && !quiz) {
                    if (scene.duration > 0) timer.current = setTimeout(nextScene, scene.duration);
                    else if (scene.quiz) { setPlay(false); setQuiz(true); }
                }
                return () => clearTimeout(timer.current);
            }, [play, idx, state, quiz]);

            const nextScene = () => { if (idx < SCENARIOS.length - 1) setIdx(p => p + 1); else { setState('won'); setPlay(false); } };
            const start = () => { playSound('click'); setState('play'); setIdx(0); setPlay(true); setFb(null); setQuiz(false); };
            const answer = (opt) => {
                if (opt.fatal) { playSound('explosion'); setFb({ ok: false, msg: opt.feedback, fatal: true }); setTimeout(() => setState('exploded'), 1000); }
                else { playSound(opt.correct ? 'correct' : 'wrong'); setFb({ ok: opt.correct, msg: opt.feedback, fatal: false }); }
            };
            const cont = () => { playSound('click'); setFb(null); setQuiz(false); setPlay(true); nextScene(); };
            const retry = () => { playSound('click'); setFb(null); setQuiz(false); setState('intro'); setIdx(0); setPlay(false); };
            const toggleFS = () => { if (!document.fullscreenElement) document.documentElement.requestFullscreen(); else if (document.exitFullscreen) document.exitFullscreen(); };

            const renderVis = () => {
                const { visual: v, intensity: i } = scene;
                if (state === 'exploded') return (
                    <div className="absolute inset-0 flex flex-col items-center justify-center z-50 bg-white animate-[flash_0.2s_ease-out_infinite]">
                        <div className="absolute inset-0 bg-gradient-to-br from-red-600 via-orange-600 to-black opacity-90 animate-pulse"></div>
                        <div className="relative z-10 text-center animate-[shake_0.5s_infinite] p-4">
                            <h1 className="text-6xl md:text-9xl font-black text-black mb-4 tracking-tighter">BÙM!!!</h1>
                            <div className="bg-black text-white p-6 rounded-2xl border-4 border-red-600 shadow-2xl">
                                <Icons.X size={60} className="mx-auto mb-2 text-red-500" />
                                <p className="text-xl md:text-3xl font-black uppercase">SAI LẦM CHẾT NGƯỜI!</p>
                                <p className="text-sm md:text-xl text-gray-300 mt-2">Nước + Dầu sôi = Nổ hơi nước.</p>
                            </div>
                            <button onClick={retry} className="mt-8 bg-red-600 text-white px-8 py-4 rounded-full font-bold text-xl hover:scale-110 transition-transform shadow-[0_0_30px_red]">THỬ LẠI</button>
                        </div>
                    </div>
                );

                return (
                    <div className="w-full h-full relative overflow-hidden bg-slate-900">
                        <div className="absolute inset-0 transition-colors duration-1000 z-0" style={{ background: `radial-gradient(circle at 50% 60%, rgba(255, ${180 - i * 30}, 0, ${0.15 + i * 0.15}) 0%, rgba(15, 23, 42, 1) 80%)` }}></div>
                        <div className="absolute top-[40%] left-1/2 -translate-x-1/2 -translate-y-1/2 z-10 w-full max-w-lg h-64 flex justify-center items-end scale-75 md:scale-100">
                            <div className={`relative w-80 h-32 bg-slate-800 rounded-b-[4rem] border-4 border-slate-600 shadow-2xl flex justify-center overflow-visible transition-transform duration-100 z-20 ${i >= 4 ? 'animate-[shake_0.5s_infinite]' : ''}`}>
                                <div className="absolute -left-32 top-6 w-36 h-6 bg-black rounded-l-full -rotate-6 shadow-xl border-b-2 border-slate-700"></div>
                                <div className="absolute inset-0 rounded-b-[4rem] overflow-hidden bg-slate-900"><div className={`absolute bottom-0 w-full h-full transition-colors duration-2000 opacity-95 ${i <= 1 ? 'bg-yellow-500' : i <= 3 ? 'bg-orange-700' : 'bg-red-950'}`}></div>{(v === 'boiling' || i > 0) && <Visuals.Boil />}</div>
                                {(v === 'fire_start' || v === 'fire_big' || v === 'fire_critical') && <Visuals.Fire s={v === 'fire_start' ? 1.2 : 2.5} />}
                                {(v === 'smoke' || i >= 3) && <Visuals.Smoke d={i} />}
                                {v === 'success' && <div className="absolute -top-8 left-[-10px] w-[108%] h-20 bg-slate-300 rounded-t-full border-b-8 border-slate-500 shadow-2xl z-50 flex justify-center items-start animate-in slide-in-from-top duration-500"><div className="w-14 h-8 bg-black rounded-t-xl mt-[-8px]"></div></div>}
                            </div>
                            <Visuals.Stove i={i} />
                        </div>
                        <div className={`absolute top-[20%] right-[5%] transition-transform duration-700 z-20 scale-75 md:scale-100 ${v === 'distracted' ? 'translate-x-60 opacity-0' : 'translate-x-0'}`}>
                            <div className={`flex flex-col items-center transform origin-top-right ${i >= 3 ? 'animate-[shake_2s_infinite]' : ''}`}>
                                <div className="bg-white p-3 rounded-full shadow-lg border-2 border-gray-300 relative z-10"><Icons.Hat size={40} className="text-slate-800" />{i >= 3 && <div className="absolute -top-2 -right-2 text-blue-400 animate-bounce bg-white rounded-full p-1 shadow-sm"><Icons.Drop size={20} /></div>}</div>
                                <div className="w-20 h-28 bg-blue-600 rounded-t-[30px] mt-[-8px] shadow-lg flex justify-center relative">{v === 'fire_critical' && <div className="absolute -left-16 top-8 animate-[pulse_0.5s_infinite] scale-125 origin-right"><div className="bg-blue-200/90 backdrop-blur w-10 h-14 rounded-b-xl border-2 border-white shadow-[0_0_20px_blue] overflow-hidden relative"><div className="absolute bottom-0 w-full h-[85%] bg-blue-500/80 animate-[wave_1s_infinite]"></div></div><div className="bg-red-600 text-white text-[8px] font-black px-1 rounded absolute -top-2 -left-1 animate-bounce">CẤM!</div></div>}</div>
                            </div>
                        </div>
                        <div className="absolute top-4 right-4 bg-black/70 backdrop-blur-md p-2 rounded-xl border border-white/20 flex items-center gap-2 z-40 shadow-lg scale-90 md:scale-100">
                            <Icons.Thermo size={20} className={i >= 4 ? "text-red-500 animate-pulse" : "text-green-500"} />
                            <div className="flex flex-col"><div className="w-24 h-2 bg-gray-800 rounded-full overflow-hidden border border-gray-700"><div className={`h-full transition-all duration-1000 ${i >= 4 ? 'bg-gradient-to-r from-orange-500 to-red-600' : i >= 2 ? 'bg-orange-500' : 'bg-green-500'}`} style={{ width: `${i * 20}%` }}></div></div></div>
                            <span className="text-xs text-white font-mono font-bold">{100 + i * 60}°C</span>
                        </div>
                        <div className="absolute bottom-0 w-full z-40">
                            <div className="h-40 bg-gradient-to-t from-black via-black/90 to-transparent absolute bottom-0 w-full pointer-events-none"></div>
                            <div className="relative pb-8 px-4 text-center">
                                <h3 className="text-orange-500 font-black text-xs uppercase tracking-widest mb-1 bg-black/50 px-2 rounded inline-block">{scene.text}</h3>
                                <p className="text-white text-xl md:text-3xl font-medium drop-shadow-lg leading-relaxed">{scene.subtext}</p>
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="w-full h-full relative font-sans">
                    {state === 'intro' && (
                        <div className="absolute inset-0 z-50 bg-slate-900 flex flex-col items-center justify-center p-4">
                            <div className="text-center">
                                <div className="inline-block p-6 rounded-full bg-gradient-to-br from-orange-500 to-red-600 mb-6 shadow-[0_0_50px_orange] animate-bounce"><Icons.Flame size={60} className="text-white" /></div>
                                <h1 className="text-5xl md:text-7xl font-black text-white mb-2 tracking-tighter">AN TOÀN BẾP</h1>
                                <p className="text-gray-400 mb-8">Mô phỏng tương tác xử lý cháy nổ</p>
                                <button onClick={start} className="bg-white text-black px-12 py-4 rounded-full font-black text-xl hover:bg-orange-500 hover:text-white transition-all transform hover:scale-105 shadow-[0_0_30px_white] flex items-center gap-3 mx-auto"><Icons.Play size={24} /> BẮT ĐẦU</button>
                                <div className="mt-8 text-xs text-gray-600">Khuyên dùng tai nghe • Chạm để tương tác</div>
                            </div>
                        </div>
                    )}
                    {state === 'won' && (
                        <div className="absolute inset-0 z-50 bg-slate-900 flex flex-col items-center justify-center p-4">
                            <div className="text-center animate-in zoom-in duration-500">
                                <div className="inline-block p-6 rounded-full bg-green-500 mb-6 shadow-[0_0_50px_green]"><Icons.Check size={60} className="text-white" /></div>
                                <h1 className="text-4xl md:text-6xl font-black text-white mb-2">XUẤT SẮC!</h1>
                                <p className="text-gray-300 mb-8 text-lg">Bạn đã nắm vững kiến thức an toàn.</p>
                                <button onClick={retry} className="bg-white text-black px-10 py-4 rounded-full font-bold text-lg hover:scale-105 transition-transform"><Icons.Play size={20} className="inline mr-2"/> CHƠI LẠI</button>
                            </div>
                        </div>
                    )}
                    {state !== 'intro' && (
                        <div className="w-full h-full relative bg-black overflow-hidden">
                            {renderVis()}
                            {quiz && !fb && (
                                <div className="absolute inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-end md:items-center justify-center p-0 md:p-4">
                                    <div className="bg-white rounded-t-3xl md:rounded-3xl w-full max-w-2xl shadow-2xl animate-in slide-in-from-bottom duration-300 overflow-hidden">
                                        <div className="bg-orange-600 p-4 text-white flex items-center gap-3">
                                            <div className="bg-white/20 p-2 rounded-lg">{scene.quiz.question.includes("BÌNH")?<Icons.Ext size={24}/>:<Icons.Alert size={24}/>}</div>
                                            <h3 className="font-black text-lg uppercase">{scene.text}</h3>
                                        </div>
                                        <div className="p-6 bg-slate-50">
                                            <p className="text-lg md:text-xl font-bold text-slate-900 mb-6">{scene.quiz.question}</p>
                                            <div className="grid gap-3">
                                                {scene.quiz.options.map((opt) => (
                                                    <button key={opt.id} onClick={() => answer(opt)} className="text-left p-4 rounded-xl border-2 border-slate-200 bg-white active:bg-orange-100 active:border-orange-500 transition-all flex items-center gap-3">
                                                        <span className="bg-orange-100 text-orange-600 font-black px-3 py-1 rounded text-sm">{opt.id}</span>
                                                        <span className="font-bold text-slate-700">{opt.text}</span>
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}
                            
                            {/* --- PHẦN POPUP PHẢN HỒI (Đã sửa) --- */}
                            {fb && (
                                <div className={`absolute z-50 transition-all duration-300 ${fb.fatal ? 'bottom-0 right-0 flex items-end justify-end p-4 pointer-events-none' : 'inset-0 bg-black/90 flex items-center justify-center p-4'}`}>
                                    <div className={`bg-white rounded-2xl shadow-2xl border-b-8 animate-in zoom-in duration-200 pointer-events-auto ${fb.fatal ? 'max-w-[250px] p-3 text-sm mb-12 mr-2 border-red-500' : 'w-full max-w-md p-6 text-center ' + (fb.ok ? 'border-green-500' : 'border-red-500')}`}>
                                        <div className={`flex justify-center ${fb.fatal ? 'mb-2' : 'mb-4'}`}>
                                            {fb.ok ? <div className={`bg-green-100 rounded-full ${fb.fatal ? 'p-2' : 'p-4'}`}><Icons.Check size={fb.fatal ? 30 : 50} className="text-green-600" /></div> : <div className={`bg-red-100 rounded-full animate-shake ${fb.fatal ? 'p-2' : 'p-4'}`}><Icons.X size={fb.fatal ? 30 : 50} className="text-red-600" /></div>}
                                        </div>
                                        <h3 className={`font-black ${fb.fatal ? 'text-lg mb-1' : 'text-3xl mb-2'} ${fb.ok ? 'text-green-700' : 'text-red-700'}`}>{fb.ok ? 'CHÍNH XÁC!' : 'SAI RỒI!'}</h3>
                                        <p className={`text-slate-600 font-medium ${fb.fatal ? 'text-xs mb-2' : 'text-lg mb-6'}`}>{fb.msg}</p>
                                        {!fb.fatal ? <button onClick={cont} className="w-full bg-slate-800 text-white font-bold py-4 rounded-xl text-lg shadow-lg">TIẾP TỤC</button> : <div className="text-red-600 font-black animate-pulse text-sm"><Icons.Zap size={16} className="inline"/> Kích hoạt nổ...</div>}
                                    </div>
                                </div>
                            )}
                            {/* --- KẾT THÚC PHẦN SỬA --- */}

                            <div className="absolute top-4 left-4 z-50 flex gap-2">
                                <button onClick={toggleFS} className="bg-white/10 p-2 rounded-full backdrop-blur text-white/70 hover:text-white"><Icons.Max size={20}/></button>
                            </div>
                            <div className="absolute bottom-4 left-4 z-50">
                                <button onClick={() => setPlay(!play)} className="bg-white/10 p-2 rounded-full backdrop-blur text-white/70 hover:text-white">{play ? <Icons.Pause size={24}/> : <Icons.Play size={24}/>}</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }
        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>